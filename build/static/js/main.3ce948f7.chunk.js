(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{33:function(e,n,o){e.exports=o(66)},38:function(e,n,o){},39:function(e,n,o){},62:function(e,n){},65:function(e,n){window.RTCPeerConnection=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,window.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate,window.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,window.URL=window.URL||window.mozURL||window.webkitURL,window.navigator.getUserMedia=window.navigator.getUserMedia||window.navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia},66:function(e,n,o){"use strict";o.r(n);var t=o(0),i=o.n(t),c=o(29),s=o.n(c),a=(o(38),o(7)),r=o(8),d=o(31),u=o(30),l=o(32),w=(o(39),o(40)),f=new(function(){function e(){var n,o=this;Object(a.a)(this,e),(n="production"!==Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_ENV?w(":4200/"):w("/")).on("connect",function(){o.socket=n,o.socket.on("peer.connected",function(e){var n=e.id;o.cb({type:"new",id:n})}),o.socket.on("incomeMsg",function(e){console.log("msg",e),o.handleMessage(e)})})}return Object(r.a)(e,[{key:"createRoom",value:function(e){var n=this;this.socket.emit("init",{name:e},function(e,o){n.cb({type:"init",roomId:e,id:o,connected:!0})})}},{key:"joinRoom",value:function(e){var n=this;this.socket.emit("init",{name:e},function(e,o){n.cb({type:"init",roomId:e,id:o,connected:!0})})}},{key:"sendMsg",value:function(e){this.socket.emit("msg",e)}},{key:"subcribe",value:function(e){this.cb=e}},{key:"getMessagehandler",value:function(e){this.handleMessage=e}}]),e}()),m=function(e){function n(e){var o;return Object(a.a)(this,n),(o=Object(d.a)(this,Object(u.a)(n).call(this,e))).state={peers:[],peerConnections:{},iceConfig:{iceServers:[]},stream:null,currentId:null,roomId:null,connected:!1},o}return Object(l.a)(n,e),Object(r.a)(n,[{key:"componentDidMount",value:function(){f.subcribe(this.updateApp.bind(this)),f.getMessagehandler(this.handleMessage.bind(this))}},{key:"updateApp",value:function(e){switch(e.type){case"init":this.setState({roomId:e.roomId,currentId:e.id,connected:e.connected});break;case"new":this.makeOffer(e.id);break;default:return}}},{key:"createRoom",value:function(e){var n=this;navigator.getUserMedia({video:{mediaSource:"screen"},audio:!0},function(e){n.setState({stream:e})},function(e){console.log(e)}),f.createRoom(e)}},{key:"joinRoom",value:function(e){var n=this;navigator.getUserMedia({video:!0,audio:!0},function(o){n.setState({stream:o}),f.joinRoom(e)},function(e){console.log(e)})}},{key:"getPeerConnection",value:function(e){var n=this;if(this.state.peerConnections[e])return this.state.peerConnections[e];var o=new RTCPeerConnection(this.state.iceConfig);return this.state.peerConnections[e]=o,o.addStream(this.state.stream),o.onicecandidate=function(o){f.sendMsg({by:n.state.currentId,to:e,ice:o.candidate,type:"ice"})},o.onaddstream=function(o){console.log("Received new stream");var t=n.state.peers;t.push({id:e,stream:o.stream}),n.setState({peers:t});var i=document.createElement("video");i.srcObject=o.stream,i.height=270,i.width=480,i.key=e,i.id=e,i.autoplay=!0,n.videosContainer.appendChild(i)},o}},{key:"makeOffer",value:function(e){var n=this.getPeerConnection(e),o=this;n.createOffer(function(t){n.setLocalDescription(t),console.log("Creating an offer for",e),f.sendMsg({by:o.state.currentId,to:e,sdp:t,type:"sdp-offer"})},function(e){console.log(e)},{mandatory:{offerToReceiveVideo:!0,offerToReceiveAudio:!0}})}},{key:"handleMessage",value:function(e){var n=this.getPeerConnection(e.by),o=this;switch(e.type){case"sdp-offer":console.log(e.sdp),n.setRemoteDescription(new RTCSessionDescription(e.sdp),function(){console.log("Setting remote description by offer"),n.createAnswer(function(t){n.setLocalDescription(t),console.log(t),f.sendMsg({by:o.state.currentId,to:e.by,sdp:t,type:"sdp-answer"})},function(e){console.log(e)})},function(e){console.log(e)});break;case"sdp-answer":console.log(e.sdp),n.setRemoteDescription(new RTCSessionDescription(e.sdp),function(){console.log("Setting remote description by answer")},function(e){console.error(e)});break;case"ice":e.ice&&(console.log("Adding ice candidates"),console.log("join"),n.addIceCandidate(new RTCIceCandidate(e.ice)))}}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"App"},i.a.createElement("button",{onClick:function(){e.createRoom("abc")}},"Create Room"),i.a.createElement("button",{onClick:function(){e.joinRoom("abc")}},"Join Room"),i.a.createElement("div",{className:"videoContainer",ref:function(n){e.videosContainer=n}}))}}]),n}(t.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o(65);s.a.render(i.a.createElement(m,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[33,1,2]]]);
//# sourceMappingURL=main.3ce948f7.chunk.js.map