(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{33:function(e,n,t){e.exports=t(66)},38:function(e,n,t){},39:function(e,n,t){},62:function(e,n){},65:function(e,n){window.RTCPeerConnection=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,window.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate,window.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,window.URL=window.URL||window.mozURL||window.webkitURL,window.navigator.getUserMedia=window.navigator.getUserMedia||window.navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia},66:function(e,n,t){"use strict";t.r(n);var o=t(0),i=t.n(o),c=t(29),s=t.n(c),a=(t(38),t(7)),r=t(8),d=t(31),u=t(30),l=t(32),w=(t(39),t(40)),f=new(function(){function e(){var n,t=this;Object(a.a)(this,e),(n=w("/")).on("connect",function(){t.socket=n,t.socket.on("peer.connected",function(e){var n=e.id;t.cb({type:"new",id:n})}),t.socket.on("incomeMsg",function(e){console.log("msg",e),t.handleMessage(e)})})}return Object(r.a)(e,[{key:"createRoom",value:function(e){var n=this;this.socket.emit("init",{name:e},function(e,t){n.cb({type:"init",roomId:e,id:t,connected:!0})})}},{key:"joinRoom",value:function(e){var n=this;this.socket.emit("init",{name:e},function(e,t){n.cb({type:"init",roomId:e,id:t,connected:!0})})}},{key:"sendMsg",value:function(e){this.socket.emit("msg",e)}},{key:"subcribe",value:function(e){this.cb=e}},{key:"getMessagehandler",value:function(e){this.handleMessage=e}}]),e}()),m=function(e){function n(e){var t;return Object(a.a)(this,n),(t=Object(d.a)(this,Object(u.a)(n).call(this,e))).state={peers:[],peerConnections:{},iceConfig:{iceServers:[]},stream:null,currentId:null,roomId:null,connected:!1},t}return Object(l.a)(n,e),Object(r.a)(n,[{key:"componentDidMount",value:function(){f.subcribe(this.updateApp.bind(this)),f.getMessagehandler(this.handleMessage.bind(this))}},{key:"updateApp",value:function(e){switch(e.type){case"init":this.setState({roomId:e.roomId,currentId:e.id,connected:e.connected});break;case"new":this.makeOffer(e.id);break;default:return}}},{key:"createRoom",value:function(e){var n=this;navigator.getUserMedia({video:{mediaSource:"screen"},audio:!0},function(e){n.setState({stream:e})},function(e){console.log(e)}),f.createRoom(e)}},{key:"joinRoom",value:function(e){var n=this;navigator.getUserMedia({video:!0,audio:!0},function(t){n.setState({stream:t}),f.joinRoom(e)},function(e){console.log(e)})}},{key:"getPeerConnection",value:function(e){var n=this;if(this.state.peerConnections[e])return this.state.peerConnections[e];var t=new RTCPeerConnection(this.state.iceConfig);return this.state.peerConnections[e]=t,t.addStream(this.state.stream),t.onicecandidate=function(t){f.sendMsg({by:n.state.currentId,to:e,ice:t.candidate,type:"ice"})},t.onaddstream=function(t){console.log("Received new stream");var o=n.state.peers;o.push({id:e,stream:t.stream}),n.setState({peers:o});var i=document.createElement("video");i.srcObject=t.stream,i.height=270,i.width=480,i.key=e,i.id=e,i.autoplay=!0,n.videosContainer.appendChild(i)},t}},{key:"makeOffer",value:function(e){var n=this.getPeerConnection(e),t=this;n.createOffer(function(o){n.setLocalDescription(o),console.log("Creating an offer for",e),f.sendMsg({by:t.state.currentId,to:e,sdp:o,type:"sdp-offer"})},function(e){console.log(e)},{mandatory:{offerToReceiveVideo:!0,offerToReceiveAudio:!0}})}},{key:"handleMessage",value:function(e){var n=this.getPeerConnection(e.by),t=this;switch(e.type){case"sdp-offer":console.log(e.sdp),n.setRemoteDescription(new RTCSessionDescription(e.sdp),function(){console.log("Setting remote description by offer"),n.createAnswer(function(o){n.setLocalDescription(o),console.log(o),f.sendMsg({by:t.state.currentId,to:e.by,sdp:o,type:"sdp-answer"})},function(e){console.log(e)})},function(e){console.log(e)});break;case"sdp-answer":console.log(e.sdp),n.setRemoteDescription(new RTCSessionDescription(e.sdp),function(){console.log("Setting remote description by answer")},function(e){console.error(e)});break;case"ice":e.ice&&(console.log("Adding ice candidates"),console.log("join"),n.addIceCandidate(new RTCIceCandidate(e.ice)))}}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"App"},i.a.createElement("button",{onClick:function(){e.createRoom("abc")}},"Create Room"),i.a.createElement("button",{onClick:function(){e.joinRoom("abc")}},"Join Room"),i.a.createElement("div",{className:"videoContainer",ref:function(n){e.videosContainer=n}}))}}]),n}(o.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));t(65);s.a.render(i.a.createElement(m,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[33,1,2]]]);
//# sourceMappingURL=main.b2b83d25.chunk.js.map